<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>즐겨찾기</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #d9d9d9;
        color: black;
        text-align: center;
        padding: 20px;
      }
      .container {
        background-color: #d9d9d9;
        width: 90%;
        max-width: 700px;
        padding: 40px;
        padding-top: 100px;
        padding-left: 350px;
      }
      .sub_container {
        background-color: #d9d9d9;
        width: 90%;
        max-width: 700px;
        text-align: left;
      }
      table {
        width: 100%;
        margin: 20px auto;
        border-collapse: collapse;
        background-color: white;
        color: black;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: center;
      }
      button {
        padding: 5px 10px;
        margin: 5px;
        cursor: pointer;
        border-radius: 5px;
        border: none;
        background-color: #f9ff82;
      }
      .back-btn {
        background-color: white;
        border: none;
        padding: 5px 10px;
        font-weight: bold;
        margin-bottom: 15px;
        border-radius: 5px;
        cursor: pointer;
      }
      .delete-btn {
        background-color: #76d4ff;
        color: black;
      }
      .confirm-btn {
        background-color: #76d4ff;
        color: black;
      }
      .popup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3);
      }
      .popup input {
        display: block;
        margin: 10px auto;
        padding: 5px;
      }
      .popup button {
        margin: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="sub_container">
        <button class="back-btn" onclick="navigateTo('계좌이체')">이전</button>
        <h1>즐겨찾기</h1>
        <input type="text" id="userId" placeholder="ID 입력" />
        <button onclick="loadFavorites()">조회</button>
        <button onclick="openPopup()">추가</button>

        <div class="popup" id="popup">
          <h3>즐겨찾기 추가</h3>
          <input type="text" id="popupUserId" placeholder="User ID" />
          <input type="text" id="popupAccountId" placeholder="Account ID" />
          <button onclick="addFavorite()">확인</button>
          <button onclick="closePopup()">취소</button>
        </div>
      </div>

      <table id="favoritesTable">
        <thead>
          <tr>
            <th>계좌번호</th>
            <th>확인</th>
            <th>삭제</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <script>
      const jwtToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjozLCJleHAiOjE3MzkyODkwMDZ9.hk2MDuCNEan0bD1OB4I97-4kchm1Iw0Gd-ik1NByTSo';  // 실제 JWT 토큰으로 교체

      function loadFavorites() {
        const userId = document.getElementById("userId").value.trim();  // 입력값에서 불필요한 공백 제거
        if (!userId) {
            alert("ID를 입력하세요.");
            return;
        }
    
        const tableBody = document.querySelector("#favoritesTable tbody");
        tableBody.innerHTML = "";
    
        fetch(`http://127.0.0.1:8000/users/favorites?jwt_token=${jwtToken}`)
            .then(response => response.json())
            .then(data => {
                const userFavorites = data.filter(fav => fav.user_id === parseInt(userId));  // 숫자로 비교
                if (userFavorites.length === 0) {
                    alert("해당 ID에 대한 즐겨찾기가 없습니다.");
                }
                userFavorites.forEach((fav, index) => {
                    const row = tableBody.insertRow();
                    row.insertCell(0).textContent = fav.account_id;
    
                    const confirmBtn = document.createElement("button");
                    confirmBtn.textContent = "확인";
                    confirmBtn.classList.add("confirm-btn");
                    confirmBtn.onclick = () => transferToAccount(fav.user_id,fav.account_id);
                    row.insertCell(1).appendChild(confirmBtn);
    
                    const deleteBtn = document.createElement("button");
                    deleteBtn.textContent = "삭제";
                    deleteBtn.classList.add("delete-btn");
                    deleteBtn.onclick = () => deleteFavorite(fav.account_id);
                    row.insertCell(2).appendChild(deleteBtn);
                });
            })
            .catch(error => {
                alert("즐겨찾기 로드 실패: " + error);
            });
      }
    

      function openPopup() {
        document.getElementById("popup").style.display = "block";
      }

      function closePopup() {
        document.getElementById("popup").style.display = "none";
      }

      function addFavorite() {
        const userId = document.getElementById("popupUserId").value;
        const accountId = document.getElementById("popupAccountId").value;

        if (userId && accountId) {
          fetch("http://127.0.0.1:8000/favorites?jwt_token=" + jwtToken + "&account_id=" + accountId, {
            method: 'POST',
            body: JSON.stringify({ user_id: userId, account_id: accountId }),
            headers: {
              'Content-Type': 'application/json',
            }
          })
            .then(response => response.json())
            .then(data => {
              alert("즐겨찾기 추가 성공");
              closePopup();
              loadFavorites();
            })
            .catch(error => alert("즐겨찾기 추가 실패: " + error));
        } else {
          alert("User ID와 Account ID를 입력하세요.");
        }
      }

      function deleteFavorite(accountId) {
        fetch(`http://127.0.0.1:8000/favorites/${accountId}?jwt_token=${jwtToken}`, {
          method: 'DELETE'
        })
          .then(response => response.json())
          .then(data => {
            alert("즐겨찾기 삭제 성공");
            loadFavorites();
          })
          .catch(error => alert("즐겨찾기 삭제 실패: " + error));
      }

      function transferToAccount(userId,accountId) {
        window.location.href = `transfer.html?user_id=${userId}&account_id=${accountId}`;
      }
    </script>
  </body>
</html>

function loginToHome(userId) {
  window.location.href = `user.html?user_id=${userId}`;
}



function loginToFavorite(userId) {
  window.location.href = `favorite.html?user_id=${userId}&account_id=${accountId}`;
}
function transferToAccount(userId) {
  window.location.href = `transfer.html?user_id=${userId}&account_id=${accountId}`;
}